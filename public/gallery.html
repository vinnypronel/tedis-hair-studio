<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gallery ‚Äì Tedi's Hair Studio</title>
  <link rel="icon" type="image/png" sizes="96x96" href="images/greylogo.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/greylogo.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="images/greylogo.png" />
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet">
  <style>
    /* Admin Controls - Only visible when logged in */
    .admin-controls {
      display: none;
      margin-bottom: 24px;
      padding: 20px;
      background: var(--card);
      border: 1px solid #242428;
      border-radius: 14px;
    }

    .admin-controls.visible {
      display: block;
    }

    .admin-controls-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .admin-badge {
      background: rgba(214, 163, 90, 0.15);
      color: var(--brand);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .upload-area {
      border: 2px dashed #333;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-area:hover {
      border-color: var(--brand);
      background: rgba(214, 163, 90, 0.05);
    }

    .upload-area.dragover {
      border-color: var(--brand);
      background: rgba(214, 163, 90, 0.1);
    }

    .upload-area .icon {
      font-size: 40px;
      margin-bottom: 12px;
    }

    .upload-area p {
      color: var(--muted);
      margin: 0;
      font-size: 14px;
    }

    .upload-area input[type="file"] {
      display: none;
    }

    .upload-preview {
      display: none;
      margin-top: 16px;
    }

    .upload-preview.visible {
      display: block;
    }

    .preview-img {
      max-width: 200px;
      border-radius: 10px;
      margin-bottom: 12px;
    }

    .upload-btn {
      background: var(--brand);
      color: #111;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-btn:hover {
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Gallery grid with delete buttons for admin */
    .gallery-item {
      position: relative;
    }

    .gallery-item .delete-btn {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;
      height: 32px;
      background: rgba(255, 107, 107, 0.9);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }

    .gallery-item .delete-btn:hover {
      background: #ff6b6b;
      transform: scale(1.1);
    }

    .admin-mode .gallery-item .delete-btn {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .gallery-item img {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
    }
  </style>
</head>

<body>

  <script src="header.js" defer></script>

  <!-- Logo Pattern Background -->
  <div class="logo-pattern-bg"></div>

  <section id="gallery">
    <div class="container">
      <h2 class="section-title">Gallery</h2>
      <p class="section-sub">Recent work.</p>

      <!-- Admin Controls (hidden by default) -->
      <div class="admin-controls" id="adminControls">
        <div class="admin-controls-header">
          <span class="admin-badge">üîê Admin Mode</span>
          <a href="admin.html" style="color: var(--brand); font-size: 13px;">View Dashboard ‚Üí</a>
        </div>

        <div class="upload-area" id="uploadArea">
          <div class="icon">üì∏</div>
          <p><strong>Click to upload</strong> or drag and drop</p>
          <p style="font-size: 12px; margin-top: 8px;">JPG, PNG, WEBP up to 10MB</p>
          <input type="file" id="fileInput" accept="image/*" />
        </div>

        <div class="upload-preview" id="uploadPreview">
          <img class="preview-img" id="previewImg" />
          <br />
          <button class="upload-btn" id="uploadBtn">Upload to Gallery</button>
          <button class="upload-btn"
            style="background: transparent; border: 1px solid #333; color: var(--text); margin-left: 10px;"
            onclick="cancelUpload()">Cancel</button>
        </div>
      </div>

      <div class="grid grid-3" id="galleryGrid">
        <!-- Static images -->
        <div class="gallery-item card">
          <img src="images/cut1.jpeg" alt="Cut 1">
        </div>
        <div class="gallery-item card">
          <img src="images/cut2.jpeg" alt="Cut 2">
        </div>
        <div class="gallery-item card">
          <img src="images/cut3.jpeg" alt="Cut 3">
        </div>
        <div class="gallery-item card">
          <img src="images/cut4.jpeg" alt="Cut 4">
        </div>
        <div class="gallery-item card">
          <img src="images/cut5.jpeg" alt="Cut 5">
        </div>
        <div class="gallery-item card">
          <img src="images/cut6.jpeg" alt="Cut 6">
        </div>
        <!-- Dynamic images will be prepended here -->
      </div>

    </div>
  </section>

  <footer>
    <div class="footer-main">
      <div class="footer-brand">
        <p>Professional barbering and grooming services in Matawan, NJ.</p>
      </div>
      <div class="footer-col">
        <h4>Browse</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="artists.html">About</a></li>

        </ul>
      </div>
      <div class="footer-col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="book.html">Book Now</a></li>
          <li><a href="gallery.html">Gallery</a></li>
          <li><a href="testimonials.html">Reviews</a></li>
        </ul>
      </div>
      <div class="footer-col footer-social">
        <h4>Follow</h4>
        <ul>
          <li>
            <a href="https://www.instagram.com/tedishairstudio/" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24" style="fill:url(#instagram-gradient-g)">
                <defs>
                  <linearGradient id="instagram-gradient-g" x1="0%" y1="100%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#FFDC80" />
                    <stop offset="10%" style="stop-color:#FCAF45" />
                    <stop offset="30%" style="stop-color:#F77737" />
                    <stop offset="50%" style="stop-color:#F56040" />
                    <stop offset="70%" style="stop-color:#FD1D1D" />
                    <stop offset="80%" style="stop-color:#E1306C" />
                    <stop offset="90%" style="stop-color:#C13584" />
                    <stop offset="100%" style="stop-color:#833AB4" />
                  </linearGradient>
                </defs>
                <path
                  d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
              </svg>
              Instagram
            </a>
          </li>
          <li>
            <a href="https://www.tiktok.com/@tedishairstudio" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24">
                <path fill="#25F4EE"
                  d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
                <path fill="#FE2C55"
                  d="M16.82 2h-1v.44a4.83 4.83 0 0 0 3.77 4.25 4.85 4.85 0 0 0 1 .1v1a8.16 8.16 0 0 1-4.77-1.52v7a6.34 6.34 0 0 1-10.86 4.43 6.33 6.33 0 0 1 4.36-10.7 6.84 6.84 0 0 1 1 .05v1a2.93 2.93 0 0 0-.88-.13 2.89 2.89 0 0 0-2.31 4.64 2.89 2.89 0 0 0 5.2-1.74V2h3.45z"
                  opacity="0.5" />
              </svg>
              TikTok
            </a>
          </li>
        </ul>
      </div>
      <div class="footer-bg-logo"><img src="images/greylogo.png" alt="" /></div>
    </div>
    <div class="footer-bottom">
      <p>¬© <span id="y"></span> Tedi's Hair Studio. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const API_URL = 'http://localhost:3000/api';
    let selectedFile = null;
    let isAdmin = false;

    // Check if admin is logged in (only show controls for admin role)
    const token = localStorage.getItem('adminToken');
    if (token) {
      fetch(`${API_URL}/auth/verify`, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
        .then(res => res.json())
        .then(data => {
          if (data.ok && data.user && data.user.role === 'admin') {
            isAdmin = true;
            document.getElementById('adminControls').classList.add('visible');
            document.getElementById('galleryGrid').classList.add('admin-mode');
          }
        })
        .catch(() => { });
    }

    // Load dynamic gallery images
    async function loadGalleryImages() {
      try {
        const res = await fetch(`${API_URL}/gallery`);
        const images = await res.json();

        const grid = document.getElementById('galleryGrid');

        // Prepend dynamic images at the beginning
        images.forEach(img => {
          const item = document.createElement('div');
          item.className = 'gallery-item card';
          item.dataset.id = img.id;
          item.innerHTML = `
            <button class="delete-btn" onclick="deleteImage(${img.id})">√ó</button>
            <img src="/images/gallery/${img.filename}" alt="${img.caption || 'Gallery image'}" />
          `;
          grid.insertBefore(item, grid.firstChild);
        });
      } catch (e) {
        console.error('Failed to load gallery:', e);
      }
    }

    loadGalleryImages();

    // Upload area functionality
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const uploadPreview = document.getElementById('uploadPreview');
    const previewImg = document.getElementById('previewImg');
    const uploadBtn = document.getElementById('uploadBtn');

    uploadArea.addEventListener('click', () => fileInput.click());

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        handleFile(file);
      }
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) handleFile(file);
    });

    function handleFile(file) {
      selectedFile = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImg.src = e.target.result;
        uploadArea.style.display = 'none';
        uploadPreview.classList.add('visible');
      };
      reader.readAsDataURL(file);
    }

    function cancelUpload() {
      selectedFile = null;
      fileInput.value = '';
      uploadArea.style.display = 'block';
      uploadPreview.classList.remove('visible');
    }

    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile) return;

      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Uploading...';

      const formData = new FormData();
      formData.append('image', selectedFile);

      try {
        const res = await fetch(`${API_URL}/gallery/upload`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` },
          body: formData
        });

        const data = await res.json();

        if (data.ok) {
          // Add new image to grid
          const grid = document.getElementById('galleryGrid');
          const item = document.createElement('div');
          item.className = 'gallery-item card';
          item.dataset.id = data.image.id;
          item.innerHTML = `
            <button class="delete-btn" onclick="deleteImage(${data.image.id})">√ó</button>
            <img src="${data.image.url}" alt="Gallery image" />
          `;
          grid.insertBefore(item, grid.firstChild);

          cancelUpload();
          alert('Image uploaded successfully!');
        } else {
          alert('Upload failed: ' + data.error);
        }
      } catch (e) {
        alert('Upload error: ' + e.message);
      }

      uploadBtn.disabled = false;
      uploadBtn.textContent = 'Upload to Gallery';
    });

    // Delete image
    async function deleteImage(id) {
      if (!confirm('Delete this image from the gallery?')) return;

      try {
        const res = await fetch(`${API_URL}/gallery/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });

        if (res.ok) {
          const item = document.querySelector(`.gallery-item[data-id="${id}"]`);
          if (item) item.remove();
        } else {
          alert('Failed to delete image');
        }
      } catch (e) {
        alert('Error: ' + e.message);
      }
    }

    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
  <script src="include.js"></script>

</body>

</html>